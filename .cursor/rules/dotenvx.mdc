---
description: Environment variable management with dotenvx encryption
alwaysApply: true
---

# Environment Variable Management with dotenvx

## Principles

- Encrypt **only sensitive values** (API keys, secrets, passwords, tokens, credentials) using `dotenvx set` or `dotenvx encrypt`
- Non-sensitive parameters (ports, log levels, feature flags, hostnames, etc.) may remain plaintext in `.env` files
- **NEVER commit `.env.keys`** — it contains private decryption keys
- Encrypted `.env` files (`.env`, `.env.production`, `.env.staging`, etc.) SHOULD be committed for version control

## .gitignore Required Entries

```
# dotenvx - never commit private decryption keys
.env.keys
```

**Note**: Only `.env.keys` is excluded. Encrypted `.env*` files are safe and intended to be committed.

## Workflow

### Adding / Updating Secrets

```bash
# Set a sensitive value (automatically encrypted)
dotenvx set SECRET_KEY "value"

# Set in a specific environment file
dotenvx set DATABASE_PASSWORD "value" -f .env.production
```

### Adding Non-Sensitive Config

Add plaintext values directly to the `.env` file — no encryption needed:

```
PORT=3000
LOG_LEVEL=info
NODE_ENV=production
```

### Encrypting Existing Plaintext Secrets

```bash
# Encrypt all unencrypted values in .env files
dotenvx encrypt
```

### Pre-Commit Checklist

```bash
# Verify .env.keys is NOT staged
git diff --cached --name-only | grep -q '.env.keys' && echo "ERROR: Remove .env.keys from staging" && exit 1

# Ensure sensitive values are encrypted
dotenvx encrypt
```

### Runtime Decryption

```bash
# Auto-decrypts using .env.keys or DOTENV_PRIVATE_KEY env var
dotenvx run -- <command>

# In production, pass the private key via environment variable
DOTENV_PRIVATE_KEY_PRODUCTION="..." dotenvx run -- <command>
```

## Prohibited

- Committing or pushing `.env.keys`
- Committing unencrypted secrets (API keys, passwords, tokens, etc.)
- Logging, hardcoding, or commenting private keys in source code
